"use strict";var underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._});var ploneVariables=angular.module("ploneVariables",[]);ploneVariables.factory("plonePortalURL",function(){return window.portal_url});var GenwebApp=angular.module("GenwebApp",["ngAnimate","ngResource","ngSanitize","ngTouch","MAXClient","underscore","ploneVariables","ui.select","ui.jq","datatables","datatables.bootstrap","angularSpinner","ngLoadingSpinner"]);GenwebApp.controller("demo1",["usSpinnerService",function(a){a.spin("spinner-1")}]),GenwebApp.controller("uLearnEditACL",["$http","plonePortalURL","MAXInfo","DTOptionsBuilder","DTColumnDefBuilder","$location","$window",function(a,b,c,d,e,f,g){var h=this;h.community_url=f.absUrl().replace("/editacl",""),h.principals=[{id:"No results found"}],h.group_results=[],h.users=[],h.groups=[],h.active_tab="users",h.dtOptions=d.newOptions().withPaginationType("full_numbers").withBootstrap(),h.dtColumnDefs=[e.newColumnDef(0),e.newColumnDef(1),e.newColumnDef(2).withOption("sSortDataType","dom-checkbox"),e.newColumnDef(3).withOption("sSortDataType","dom-checkbox"),e.newColumnDef(4).withOption("sSortDataType","dom-checkbox")];var i="",j=0;h.searchUser=function(c){return a.get(b+"/omega13usersearch",{params:{q:c,last_query:i,last_query_count:j}}).then(function(a){i=c,j=a.data.last_query_count,h.principals=a.data.results})},h.searchGroup=function(c){return a.get(b+"/omega13groupsearch",{params:{q:c}}).then(function(a){h.group_results=a.data.results})},h.selectUser=function(a){a.role="reader",h.users.push(a)},h.selectGroup=function(a){a.role="reader",h.groups.push(a)},h.saveAcl=function(){a.post(b+"/api/communities/"+h.gwuuid+"/subscriptions",{users:h.users,groups:h.groups},{headers:c.headers}).success(function(){g.location=h.community_url}).error(function(){console.log("error")})}}]),GenwebApp.directive("acl",[function(){return{link:function(a,b,c){var d=angular.fromJson(c.acl);a.ctrl.users=d.users,a.ctrl.groups=void 0!==d.groups?d.groups:[]}}}]),GenwebApp.directive("maxActivitiesCount",[function(){return{controller:function(a,b,c,d,e){"context"===c.object&&e.get_count(c.communityHash).then(function(c){b.text(c.headers("X-totalItems")),a.context_activities=c.headers("X-totalItems")}),"user"===c.object&&(a.user_act_promise=d.get_count(c.username).then(function(c){b.text(c.headers("X-totalItems")),a.user_activities=c.headers("X-totalItems")}))}}}]),GenwebApp.directive("badge",[function(){return{template:'<div><img ng-src="{{portal_url}}/{{badge_prefix}}{{badge_png}}" /></div>',scope:!0,replace:!0,link:function(a,b,c){a.badge_png=c.image.replace(".png","-alt.png"),a.badge_prefix="/++ulearn++static/images/","True"===a.badge_enabled&&(a.badge_png=c.image)},controller:function(a,b,c,d){a.portal_url=d,a.user_act_promise.then(function(){a.user_activities>=c.threshold&&(a.badge_prefix="",a.badge_png=c.image)})}}}]),GenwebApp.directive("lastauthors",[function(){return{controller:function(a,b,c,d,e,f,g){a.portal_url=d,a.last_authors="timeline"===c.type?f.query({username:e.username,limit:8}):g.query({hash:c.communityHash,limit:8})}}}]),GenwebApp.directive("communitiesstats",[function(){return{controller:function(a,b,c,d){d.get_count(c.communityHash).then(function(b){a.users_comments=b.headers("X-totalItems")})}}}]),GenwebApp.directive("generalstats",[function(){return{controller:function(a,b,c,d,e,f){e.get_count().then(function(b){a.all_activities=b.headers("X-totalItems")}),f.get_count().then(function(b){a.all_comments=b.headers("X-totalItems")})}}}]);