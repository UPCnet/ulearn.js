"use strict";var underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._});var ploneVariables=angular.module("ploneVariables",[]);ploneVariables.factory("plonePortalURL",function(){return window.portal_url});var GenwebApp=angular.module("GenwebApp",["ngAnimate","ngResource","ngSanitize","ngTouch","MAXClient","underscore","ploneVariables","ui.select","ui.jq","datatables","datatables.bootstrap","angularSpinner","ngLoadingSpinner"]);GenwebApp.controller("demo1",["usSpinnerService",function(a){a.spin("spinner-1")}]),GenwebApp.controller("uLearnEditACL",["$http","plonePortalURL","MAXInfo","DTOptionsBuilder","DTColumnDefBuilder","$location","$window",function(a,b,c,d,e,f,g){var h=this;h.community_url=f.absUrl().replace("/editacl",""),h.principals=[{id:"No results found"}],h.group_results=[],h.users=[],h.groups=[],h.active_tab="users",h.dtOptions=d.newOptions().withPaginationType("full_numbers").withBootstrap(),h.dtColumnDefs=[e.newColumnDef(0),e.newColumnDef(1),e.newColumnDef(2).withOption("sSortDataType","dom-checkbox"),e.newColumnDef(3).withOption("sSortDataType","dom-checkbox"),e.newColumnDef(4).withOption("sSortDataType","dom-checkbox")];var i="",j=0;h.searchUser=function(c){return a.get(b+"/omega13usersearch",{params:{q:c,last_query:i,last_query_count:j}}).then(function(a){i=c,j=a.data.last_query_count,h.principals=a.data.results})},h.searchGroup=function(c){return a.get(b+"/omega13groupsearch",{params:{q:c}}).then(function(a){h.group_results=a.data.results})},h.selectUser=function(a){a.role="reader",h.users.push(a)},h.selectGroup=function(a){a.role="reader",h.groups.push(a)},h.saveAcl=function(){a.post(b+"/api/communities/"+h.gwuuid+"/subscriptions",{users:h.users,groups:h.groups},{headers:c.headers}).success(function(){g.location=h.community_url}).error(function(){console.log("error")})}}]),GenwebApp.directive("acl",[function(){return{link:function(a,b,c){var d=angular.fromJson(c.acl);a.ctrl.users=d.users,a.ctrl.groups=void 0!==d.groups?d.groups:[]}}}]),GenwebApp.directive("maxActivitiesCount",[function(){return{controller:function(a,b,c,d,e){"context"===c.object&&e.get_count(c.communityHash).then(function(c){b.text(c.headers("X-totalItems")),a.context_activities=c.headers("X-totalItems")}),"user"===c.object&&(a.user_act_promise=d.get_count(c.username).then(function(c){b.text(c.headers("X-totalItems")),a.user_activities=c.headers("X-totalItems")}))}}}]),GenwebApp.directive("badge",[function(){return{template:'<div><img ng-src="{{portal_url}}/{{badge_prefix}}{{badge_png}}" /></div>',scope:!0,replace:!0,link:function(a,b,c){a.badge_png=c.image.replace(".png","-alt.png"),a.badge_prefix="/++ulearn++static/images/","True"===a.badge_enabled&&(a.badge_png=c.image)},controller:function(a,b,c,d){a.portal_url=d,a.user_act_promise.then(function(){a.user_activities>=c.threshold&&(a.badge_prefix="",a.badge_png=c.image)})}}}]),GenwebApp.directive("lastauthors",[function(){return{controller:function(a,b,c,d,e,f,g){a.portal_url=d,a.last_authors="timeline"===c.type?f.query({username:e.username,limit:8}):g.query({hash:c.communityHash,limit:8})}}}]),GenwebApp.directive("communitiesstats",[function(){return{controller:function(a,b,c,d){d.get_count(c.communityHash).then(function(b){a.users_comments=b.headers("X-totalItems")})}}}]),GenwebApp.directive("generalstats",[function(){return{controller:function(a,b,c,d,e,f){e.get_count().then(function(b){a.all_activities=b.headers("X-totalItems")}),f.get_count().then(function(b){a.all_comments=b.headers("X-totalItems")})}}}]);var MAXClient=angular.module("MAXClient",[]);MAXClient.factory("Contexts",["$resource","MAXInfo",function(a,b){return a(b.max_server+"/contexts",null,{search:{method:"GET",params:{tags:"@tags",hash:"@hash"},headers:b.headers,isArray:!0}})}]),MAXClient.factory("ApiInfo",["$resource","MAXInfo",function(a,b){return a(b.max_server+"/info/api",null,{query:{method:"GET"},by_category:{method:"GET",params:{by_category:"1"},isArray:!0}})}]),MAXClient.factory("ContextActivities",["$http","MAXInfo",function(a,b){var c=this;return c.get_count=function(c){return a.head(b.max_server+"/contexts/"+c+"/activities",{headers:b.headers})},c}]),MAXClient.factory("UserActivities",["$http","MAXInfo",function(a,b){var c=this;return c.get_count=function(c){return a.head(b.max_server+"/people/"+c+"/activities",{headers:b.headers})},c}]),MAXClient.factory("TimelineLastAuthors",["$resource","MAXInfo",function(a,b){return a(b.max_server+"/people/:username/timeline/authors",null,{query:{method:"GET",params:{limit:"@limit"},headers:b.headers,isArray:!0}})}]),MAXClient.factory("ContextLastAuthors",["$resource","MAXInfo",function(a,b){return a(b.max_server+"/contexts/:hash/activities/authors",null,{query:{method:"GET",params:{limit:"@limit"},headers:b.headers,isArray:!0}})}]),MAXClient.factory("UsersComments",["$http","MAXInfo",function(a,b){var c=this;return c.get_count=function(c){return a.head(b.max_server+"/contexts/"+c+"/comments",{headers:b.headers})},c}]),MAXClient.factory("AllActivities",["$http","MAXInfo",function(a,b){var c=this;return c.get_count=function(){return a.head(b.max_server+"/activities",{headers:b.headers})},c}]),MAXClient.factory("AllComments",["$http","MAXInfo",function(a,b){var c=this;return c.get_count=function(){return a.head(b.max_server+"/activities/comments",{headers:b.headers})},c}]),MAXClient.factory("MAXInfo",["MAXSession","_MAXUI",function(a,b){var c={};return b?(c.headers={"X-Oauth-Username":b.username,"X-Oauth-Token":b.oauth_token,"X-Oauth-Scope":"widgetcli"},c.max_server=b.max_server,c.username=b.username):(c.headers={"X-Oauth-Username":a.username,"X-Oauth-Token":a.oauth_token,"X-Oauth-Scope":"widgetcli"},c.max_server=a.max_server,c.username=a.username),c}]),MAXClient.value("MAXSession",{username:"",oauth_token:"",max_server:""}),MAXClient.factory("_MAXUI",[function(){return void 0!==window._MAXUI?window._MAXUI:!1}]),MAXClient.directive("oauthinfo",[function(){return{restrict:"E",controller:function(a,b,c,d){d.username=c.username,d.oauth_token=c.oauthToken,d.max_server=c.maxServer}}}]),angular.module("MAXClient").service("MAXUtils",[function(){var a=this;return a.sha1=function(a){function b(a,b){var c=a<<b|a>>>32-b;return c}function c(a){var b,c,d="";for(b=7;b>=0;b--)c=a>>>4*b&15,d+=c.toString(16);return d}function d(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var e,f,g,h,i,j,k,l,m,n=new Array(80),o=1732584193,p=4023233417,q=2562383102,r=271733878,s=3285377520;a=d(a);var t=a.length,u=[];for(f=0;t-3>f;f+=4)g=a.charCodeAt(f)<<24|a.charCodeAt(f+1)<<16|a.charCodeAt(f+2)<<8|a.charCodeAt(f+3),u.push(g);switch(t%4){case 0:f=2147483648;break;case 1:f=a.charCodeAt(t-1)<<24|8388608;break;case 2:f=a.charCodeAt(t-2)<<24|a.charCodeAt(t-1)<<16|32768;break;case 3:f=a.charCodeAt(t-3)<<24|a.charCodeAt(t-2)<<16|a.charCodeAt(t-1)<<8|128}for(u.push(f);u.length%16!==14;)u.push(0);for(u.push(t>>>29),u.push(t<<3&4294967295),e=0;e<u.length;e+=16){for(f=0;16>f;f++)n[f]=u[e+f];for(f=16;79>=f;f++)n[f]=b(n[f-3]^n[f-8]^n[f-14]^n[f-16],1);for(h=o,i=p,j=q,k=r,l=s,f=0;19>=f;f++)m=b(h,5)+(i&j|~i&k)+l+n[f]+1518500249&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=20;39>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+1859775393&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=40;59>=f;f++)m=b(h,5)+(i&j|i&k|j&k)+l+n[f]+2400959708&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;for(f=60;79>=f;f++)m=b(h,5)+(i^j^k)+l+n[f]+3395469782&4294967295,l=k,k=j,j=b(i,30),i=h,h=m;o=o+h&4294967295,p=p+i&4294967295,q=q+j&4294967295,r=r+k&4294967295,s=s+l&4294967295}return m=c(o)+c(p)+c(q)+c(r)+c(s),m.toLowerCase()},a}]);